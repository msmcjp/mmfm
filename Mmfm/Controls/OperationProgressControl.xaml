<UserControl x:Class="Mmfm.OperationProgressControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" >
    <i:Interaction.Triggers>
        <i:DataTrigger Binding="{Binding OperationFinished}" Value="True">
            <i:ChangePropertyAction TargetObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}" PropertyName="DialogResult" Value="True"/>
        </i:DataTrigger>

        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding StartOperationCommand}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    
    <StackPanel Orientation="Vertical" Width="400">
        <Label Content="{Binding Caption}" VerticalAlignment="Bottom" Margin="5" FontSize="14"/>
        <ProgressBar Height="20" Margin="10,0,10,0" Minimum="0" Maximum="{Binding Count, Mode=OneWay}" Value="{Binding Value, Mode=OneWay}"/>
        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding Current}" Margin="10,4,10,10" />
        <Button x:Name="Cancel" Content="Cancel" Width="80" Margin="10" HorizontalAlignment="Right" Command="{Binding CancelCommand}"/>
    </StackPanel>
</UserControl>
